<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Show me the code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="talk is cheap show me the code">
<meta property="og:type" content="website">
<meta property="og:title" content="Show me the code">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Show me the code">
<meta property="og:description" content="talk is cheap show me the code">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Show me the code">
<meta name="twitter:description" content="talk is cheap show me the code">
  
    <link rel="alternate" href="/atom.xml" title="Show me the code" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Show me the code</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">这是subtitle</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-aboutbenchmark" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/05/aboutbenchmark/" class="article-date">
  <time datetime="2016-04-05T09:33:16.000Z" itemprop="datePublished">2016-04-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/05/aboutbenchmark/">关于benchmark</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个词并不陌生，很多成熟框架的作者都会附带着benchmark。benchmark直译就是评测对比。<br>比如我们想测试对比两个方法的运行速度 通常我们都会在方法的开头和结尾获取绝对时间。例如<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CFTimeInterval</span> beginTime = <span class="built_in">CACurrentMediaTime</span>();</span><br><span class="line"><span class="comment">//被测试的代码段</span></span><br><span class="line"><span class="built_in">CFTimeInterval</span> endTime =<span class="built_in">CACurrentMediaTime</span>();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"Time delta:%g"</span>,endTime-beginTime);</span><br></pre></td></tr></table></figure></p>
<p>不过CoreFoundation提供了一种更优雅的实现方式。不过这个api并不是公开的。但是可以被man到，终端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man dispatch_benchmark(3)</span><br></pre></td></tr></table></figure></p>
<p>由于方法未公开，所以使用前要先声明。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> uint64_t dispatch_benchmark(size_t count, <span class="keyword">void</span> (^block)(<span class="keyword">void</span>));</span><br></pre></td></tr></table></figure>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ul>
<li>block块 需要测试的代码块</li>
<li>count 被测试代码运行次数</li>
<li>返回值 被测试代码经过count次迭代所需要的平均时间</li>
</ul>
<p>下面我们就用这个方法来测试对比一下4种遍历Array的效率。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSInteger</span> iterationTimes = <span class="number">1000</span>; <span class="comment">//迭代次数</span></span><br><span class="line">        <span class="built_in">NSInteger</span> arrayCount = <span class="number">100000</span>;<span class="comment">//数组大小</span></span><br><span class="line">        <span class="built_in">NSMutableArray</span> * arr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;arrayCount; i++) &#123;</span><br><span class="line">            [arr addObject:@(i)];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//for each 方式</span></span><br><span class="line">        uint64_t t_foreach = dispatch_benchmark(iterationTimes, ^&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i=<span class="number">0</span>; i&lt;arrayCount; i++) &#123;</span><br><span class="line">                <span class="built_in">NSNumber</span> * num = arr[i];</span><br><span class="line">                [num integerValue];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"for each迭代%ld次平均时间 %llu ns"</span>, iterationTimes,t_foreach);</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//for in 方式</span></span><br><span class="line">        uint64_t t_forin = dispatch_benchmark(iterationTimes, ^&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">NSNumber</span> * num <span class="keyword">in</span> arr) &#123;</span><br><span class="line">                [num integerValue];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"for in迭代%ld次平均时间 %llu ns"</span>, iterationTimes,t_forin);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//block枚举方式</span></span><br><span class="line">        uint64_t t_enu_block = dispatch_benchmark(iterationTimes, ^&#123;</span><br><span class="line">            [arr enumerateObjectsUsingBlock:^(<span class="built_in">NSNumber</span>*  _Nonnull num, <span class="built_in">NSUInteger</span> idx, <span class="built_in">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">                [num integerValue];</span><br><span class="line">                ;</span><br><span class="line">            &#125;];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"enu_block 迭代%ld次平均时间 %llu ns"</span>, iterationTimes,t_enu_block);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//枚举器方式</span></span><br><span class="line">        uint64_t t_enamerator = dispatch_benchmark(iterationTimes, ^&#123;</span><br><span class="line">            <span class="built_in">NSEnumerator</span> * enumerator = [arr objectEnumerator];</span><br><span class="line">            <span class="built_in">NSNumber</span> * num ;</span><br><span class="line">            <span class="keyword">while</span> (num=[enumerator nextObject]) &#123;</span><br><span class="line">                [num integerValue];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"enamerator 迭代%ld次平均时间 %llu ns"</span>, iterationTimes,t_enamerator);</span><br></pre></td></tr></table></figure>
<p>测试环境</p>
<ul>
<li>MacBook Pro（Retina 显示屏，13 英寸，2015 年初期）</li>
<li>处理器2.7 GHz Intel Core i5</li>
<li>内存8 GB 1867 MHz DDR3</li>
<li>图形卡Intel Iris Graphics 6100 1536 MB</li>
<li>Xcode7.1</li>
<li>满电量，外置电源</li>
</ul>
<p>对于不同容量的数组测试数据如下.单位ns 纳秒。红色字体代表最快</p>
<table>
<thead>
<tr>
<th>数组容量/方式</th>
<th>for each</th>
<th>for in</th>
<th>enu_block</th>
<th>enumerator</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><font color="red">56</font></td>
<td>136</td>
<td>130</td>
<td>4207</td>
</tr>
<tr>
<td>10</td>
<td>614</td>
<td><font color="red">365</font></td>
<td>705</td>
<td>4497</td>
</tr>
<tr>
<td>100</td>
<td>3056</td>
<td><font color="red">1870</font></td>
<td>5061</td>
<td>6373</td>
</tr>
<tr>
<td>1000</td>
<td>28080</td>
<td><font color="red">13874</font></td>
<td>48845</td>
<td>33773</td>
</tr>
<tr>
<td>10000</td>
<td>283182</td>
<td><font color="red">146055</font></td>
<td>493017</td>
<td>272574</td>
</tr>
<tr>
<td>100000</td>
<td>2767874</td>
<td><font color="red">1431035</font></td>
<td>4720343</td>
<td>2731877</td>
</tr>
</tbody>
</table>
<p>从上表可以看出 四种遍历方式里，出去第一组数据只有一个的边际情况。其余的都是forin方式最快。其次是for each。最慢的是枚举器。</p>
<p>测试用例有可能的遗漏</p>
<ul>
<li>存里的都是NSNumber对象，不确定NSArray对于所有对象的存储是否一视同仁，对其他特殊的对象的存储是否有优化</li>
<li>测试工程是Command line tool工程。测试方法写在main函数里，不确定在移动平台的不同cpu架构上的表现。</li>
<li>最后一组用例的测试的时候cpu占用率一度达到了100%，不确定用例的先后顺序是否对结果有影响。</li>
</ul>
<h3 id="！！！枚举器外置声明"><a href="#！！！枚举器外置声明" class="headerlink" title="！！！枚举器外置声明"></a>！！！枚举器外置声明</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//枚举器方式</span></span><br><span class="line"><span class="built_in">NSEnumerator</span> * enumerator_out = [arr objectEnumerator];<span class="comment">//注意这句，不包含在测试代码里。</span></span><br><span class="line">uint64_t t_enamerator_out = dispatch_benchmark(iterationTimes, ^&#123;</span><br><span class="line">    <span class="built_in">NSNumber</span> * num ;</span><br><span class="line">    <span class="keyword">while</span> (num=[enumerator_out nextObject]) &#123;</span><br><span class="line">        [num integerValue];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"enamerator 迭代%ld次平均时间 %llu ns"</span>, iterationTimes,t_enamerator_out);</span><br></pre></td></tr></table></figure>
<p>把枚举器放到外部的时候，遍历花的时间要远远少于其他几种方式。也就是说多次遍历不可变数组的时候，声明一个全局的枚举器是一种很好的选择。其余情况还是尽量选择平均效率最好的forin方式吧。</p>
<p><a href="http://nshipster.com/benchmarking/" target="_blank" rel="external">参考文章 benchmarking</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/05/aboutbenchmark/" data-id="cimn9hgl20000vo4dyy7sghdf" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-stackjson" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/31/stackjson/" class="article-date">
  <time datetime="2016-03-31T05:50:57.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/31/stackjson/">OC数据结构（三.1）：用栈和状态机完成JSON解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>文章的灵感及主要解析算法来自于一位前辈的博客<a href="http://www.liaoxuefeng.com/article/0014211269349633dda29ee3f29413c91fa65c372585f23000" target="_blank" rel="external">如何编写一个JSON解析器</a>以及上篇中的<a href="http://cocoa1024.com/2016/03/30/stack-usage/#more" target="_blank" rel="external">括号匹配算法</a>，我用OC实现了解析算法，由于前辈博客中的语言比较简练，对算法没有过多描述，所以我决定开一篇博客去详细描述过程。OC版本的实现代码已经上传<a href="https://github.com/SecondDog/SlowJsonParser" target="_blank" rel="external">Github</a></p>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><p>json(JavaScript Object Notation)<strong>我自己的翻译是JavaScript对象标记法</strong>。<a href="http://www.json.org/json-zh.html" target="_blank" rel="external">这里是官网的介绍</a>。感觉中文的翻译好生硬，为了文章后篇的顺利阅读，我简要归纳一下。</p>
<h3 id="JSON中的控制字符"><a href="#JSON中的控制字符" class="headerlink" title="JSON中的控制字符"></a>JSON中的控制字符</h3><ul>
<li>{ 键-值对容器（A collection of name/value pairs）的开始</li>
<li>} 键-值对容器的结束</li>
<li>[ 数组容器的开始</li>
<li>] 数组容器的结束</li>
<li>: 键-值对分隔符</li>
<li>“ 字符串的开始或者结束</li>
<li>, 容器内部的分隔符</li>
</ul>
<h3 id="JSON中的值的类型"><a href="#JSON中的值的类型" class="headerlink" title="JSON中的值的类型"></a>JSON中的值的类型</h3><ul>
<li>string 两个双引号中间的部分，官网原文<strong><em>是由双引号包围的任意数量Unicode字符的集合，使用反斜线转义。一个字符（character）即一个单独的字符串</em></strong> 在OC中的表现为NSString对象</li>
<li>number 以字符’0’或‘9’开头，官网原文<strong><em>除去未曾使用的八进制与十六进制格式</em></strong>， 在OC中的表现为NSNumber对象.</li>
<li>object 对象类型，在OC中的表现为NSDictionary</li>
<li>值的有序列表（An ordered list of values），俗称array，在OC中的表现为NSArray</li>
<li>null null对象，空对象，在OC中的表现为NSNull</li>
<li>bool true/false 由于OC中并没有关于Boolean对象的存在，所以在OC中的表现为NSNumber</li>
</ul>
<p>按照以上的定义，在json解析器的实现中会存在一些争议，比如大小写敏感的true，True，False，false，Null，”\<null\>“”等，对于容器末尾”,”的处理, 对[1,] {“k”:”v”,}是否合法的认定，以及对单值对象的认定例如”a”或者 1 或者null 这种存在是否合法的认定。对于带有科学计数法数字的解析和越界检查。对于一个好的解析器来讲，要充分包容这些异常。在不同语言不同标准的实现下，会产生不同的结果，所以不同平台的开发者要充分沟通，制定相对严格并且统一的json标准。我们之前的开发就由于web端和OC端的实现不同，导致某些情况下解析出来的NSString对象莫名的多出一些空格和问号。</null\></p>
<h2 id="JSON的解析"><a href="#JSON的解析" class="headerlink" title="JSON的解析"></a>JSON的解析</h2><h3 id="状态机"><a href="#状态机" class="headerlink" title="状态机"></a>状态机</h3><p>状态机的定义就不详述了（其实我也详述不明白），这里的状态机指的是有限状态机，保证状态的跳转次数是有限的，这样才能保证程序能够执行的完。状态机完成状态机最终要的就是实现状态的转移和值的记录。其实类似的思想在我们的日常编程中已经有所体现。在AFNetworking里也有关于状态机的运用。在AFUrlConnectionOperation中，operation有isReady(准备就绪),isExecuting(执行中),isFinished(已完成),isPaused(暂停中)。AF的作者定义了一个方法来确认不同状态的转换是否合法,只有在合法状态下才会发生key-value的变化并产生通知,方法如下<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="built_in">BOOL</span> AFStateTransitionIsValid(AFOperationState fromState, AFOperationState toState, <span class="built_in">BOOL</span> isCancelled) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (fromState) &#123;</span><br><span class="line">        <span class="keyword">case</span> AFOperationReadyState:</span><br><span class="line">            <span class="keyword">switch</span> (toState) &#123;</span><br><span class="line">                <span class="keyword">case</span> AFOperationPausedState:</span><br><span class="line">                <span class="keyword">case</span> AFOperationExecutingState:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">                <span class="keyword">case</span> AFOperationFinishedState:</span><br><span class="line">                    <span class="keyword">return</span> isCancelled;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> AFOperationExecutingState:</span><br><span class="line">            <span class="keyword">switch</span> (toState) &#123;</span><br><span class="line">                <span class="keyword">case</span> AFOperationPausedState:</span><br><span class="line">                <span class="keyword">case</span> AFOperationFinishedState:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> AFOperationFinishedState:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        <span class="keyword">case</span> AFOperationPausedState:</span><br><span class="line">            <span class="keyword">return</span> toState == AFOperationReadyState;</span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line"><span class="meta">#pragma clang diagnostic push</span></span><br><span class="line"><span class="meta">#pragma clang diagnostic ignored <span class="meta-string">"-Wunreachable-code"</span></span></span><br><span class="line">            <span class="keyword">switch</span> (toState) &#123;</span><br><span class="line">                <span class="keyword">case</span> AFOperationPausedState:</span><br><span class="line">                <span class="keyword">case</span> AFOperationReadyState:</span><br><span class="line">                <span class="keyword">case</span> AFOperationExecutingState:</span><br><span class="line">                <span class="keyword">case</span> AFOperationFinishedState:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#pragma clang diagnostic pop</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>例如<br>从ready状态-&gt;pause状态和finish状态合法<br>从executing状态-&gt;pause状态或者finish状态合法<br>从paused状态-&gt;ready状态合法<br>关于AF和NSOperation我会开篇博客详细说明，这里暂时不多说。通过这些应该能够理解状态机和状态转换的概念。再举个例子，例如一个人，就是你吧，有吃饭，喝水，睡觉，上厕所几种状态。从吃饭-&gt;喝水，合法，吃饭-&gt;上厕所你可以认定他合法，上厕所-&gt;吃饭你也可以认定他合法，合不合法全凭你自己说了算，你开心就好。<br>程序的合法与否也是由你自己定义，不过现在你开心不管用了，要程序开心才行，否则程序就会死循环起来或者崩溃，这会让你不开心的的。</p>
<p>有了以上的认知，我们对json解析的实现就有了一个大体的思路，首先要对json串进行扫描，扫描到对应的控制字符要变更相应的状态，根据这些状态继续扫描 生成/存储数据对象或者抛出异常，重复这一过程直到字符串末尾。</p>
<h3 id="token及对应转移状态定义"><a href="#token及对应转移状态定义" class="headerlink" title="token及对应转移状态定义"></a>token及对应转移状态定义</h3><p>#####表1 token名称及合法状态✅</p>
<table>
<thead>
<tr>
<th>token名称/(期待)可转移状态</th>
<th>字典开始</th>
<th>字典结束</th>
<th>数组开始</th>
<th>数组结束</th>
<th>单值</th>
<th>数组中的值</th>
<th>字典key</th>
<th>字典value</th>
<th>冒号</th>
<th>逗号</th>
<th>文件结束</th>
</tr>
</thead>
<tbody>
<tr>
<td>字典开始 {</td>
<td>✅</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>字典结束 }</td>
<td></td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>数组开始 [</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>数组结束 ]</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>冒号 :</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>逗号 ,</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>字符串</td>
<td></td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>数字</td>
<td></td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>Boolean</td>
<td></td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>空</td>
<td></td>
<td>✅</td>
<td></td>
<td>✅</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<h3 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h3><p>第一行第一列,如果当前token状态为字典开始状态，那么他可以期待字典结束状态因为{}是可以构成合法json的，<br>第一行的第三列 如果期待数组开始 {[那么这种情况明显是非法的 因为没有key。<br>所以根据上面的表格我们可以构造出token的枚举和(期待)状态的枚举，我们需要用一个全局变量在类内记录对应的token以及根据当前的期待值构造出下次的可期待状态。<br>代码如下</p>
<h3 id="token类型的枚举"><a href="#token类型的枚举" class="headerlink" title="token类型的枚举"></a>token类型的枚举</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span>:<span class="built_in">NSInteger</span>&#123;</span><br><span class="line">    TokenTypeEndDocument, <span class="comment">//结尾</span></span><br><span class="line">    TokenTypeBeginDict, <span class="comment">//&#123;</span></span><br><span class="line">    TokenTypeEndDict, <span class="comment">//&#125;</span></span><br><span class="line">    TokenTypeBeginArray,<span class="comment">//[</span></span><br><span class="line">    TokenTypeEndArray,<span class="comment">//]</span></span><br><span class="line">    TokenTypeSEPColon,<span class="comment">//:</span></span><br><span class="line">    TokenTypeSEPComma,<span class="comment">//,</span></span><br><span class="line">    TokenTypeString,<span class="comment">//string</span></span><br><span class="line">    TokenTypeBoolean,<span class="comment">//bool</span></span><br><span class="line">    TokenTypeNumber,<span class="comment">//number</span></span><br><span class="line">    TokenTypeNull,<span class="comment">//null</span></span><br><span class="line">    </span><br><span class="line">    TokenTypeError,</span><br><span class="line">&#125;TokenType;</span><br></pre></td></tr></table></figure>
<h3 id="状态的枚举"><a href="#状态的枚举" class="headerlink" title="状态的枚举"></a>状态的枚举</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span>:<span class="built_in">NSInteger</span>&#123;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span>:<span class="built_in">NSInteger</span> &#123;</span><br><span class="line">    STATUS_EXPECT_BEGIN_DICTIONARY=<span class="number">1</span>&lt;&lt;<span class="number">0</span>,</span><br><span class="line">    STATUS_EXPECT_END_DICTIONARY=<span class="number">1</span>&lt;&lt;<span class="number">1</span>,</span><br><span class="line">    STATUS_EXPECT_BEGIN_ARRAY=<span class="number">1</span>&lt;&lt;<span class="number">2</span>,</span><br><span class="line">    STATUS_EXPECT_END_ARRAY=<span class="number">1</span>&lt;&lt;<span class="number">3</span>,</span><br><span class="line">    STATUS_EXPECT_SINGLE_VALUE=<span class="number">1</span>&lt;&lt;<span class="number">4</span>,</span><br><span class="line">    STATUS_EXPECT_ARRAY_VALUE=<span class="number">1</span>&lt;&lt;<span class="number">5</span>,</span><br><span class="line">    STATUS_EXPECT_DICTIONARY_KEY=<span class="number">1</span>&lt;&lt;<span class="number">6</span>,</span><br><span class="line">    STATUS_EXPECT_DICTIONARY_VALUE=<span class="number">1</span>&lt;&lt;<span class="number">7</span>,</span><br><span class="line">    STATUS_EXPECT_COLON=<span class="number">1</span>&lt;&lt;<span class="number">8</span>,</span><br><span class="line">    STATUS_EXPECT_COMMA=<span class="number">1</span>&lt;&lt;<span class="number">9</span>,</span><br><span class="line">    STATUS_EXPECT_END_DOCUMENT=<span class="number">1</span>&lt;&lt;<span class="number">10</span>,</span><br><span class="line">&#125;STATUS_EXPECT_;</span><br><span class="line">&#125;TokenType;</span><br></pre></td></tr></table></figure>
<p>状态之所以要带上位移是因为状态是可以组合存在的，另外还需要一个函数辅助去判断是组合值中是否包含某种状态。其实就是位操作的一个小技巧。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">JSONParser</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    STATUS_EXPECT_ _status;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">JSONParser</span></span></span><br><span class="line"></span><br><span class="line">-(<span class="built_in">BOOL</span>)_hasStatus:(STATUS_EXPECT_)status</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (_status&amp;status)!=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先烂尾，明天写tokenReader</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/31/stackjson/" data-id="cimn9hglz0007vo4d9oatdqow" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-stack-usage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/30/stack-usage/" class="article-date">
  <time datetime="2016-03-30T05:55:18.000Z" itemprop="datePublished">2016-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/30/stack-usage/">OC数据结构（二）：栈的用途</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="从LeetCode的第20题说起"><a href="#从LeetCode的第20题说起" class="headerlink" title="从LeetCode的第20题说起"></a>从LeetCode的第20题说起</h2><blockquote>
<p>Given a string containing just the characters ‘(‘, ‘)’, ‘{‘, ‘}’, ‘[‘ and ‘]’, determine if the input string is valid.<br>The brackets must close in the correct order, “()” and “()[]{}” are all valid but “(]” and “([)]” are not.<br>
        
          <p class="article-more-link">
            <a href="/2016/03/30/stack-usage/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/30/stack-usage/" data-id="cimn9hglu0006vo4dnzfq553l" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-stack-gen" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/30/stack-gen/" class="article-date">
  <time datetime="2016-03-30T05:38:40.000Z" itemprop="datePublished">2016-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/30/stack-gen/">OC数据结构（二）：栈的生成</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>栈（stack）作为数据结构里的最基础，最简单，最经典的模型，从我们一上学开始就被一再提起。C++的STL更是把栈作为一种基础的模板直接封装在其框架之内了，java语言也有StackUtil。但是OC中没有关于栈的容器，所以我实现了NSStack类，内部包装一个数组作为容器。初始化的时候初始化内部的数组，入栈就是在数组末尾添加元素，出栈就是从获取数组的最后一个元素，栈空就是数组count为0 下面是栈的行为定义<br>
        
          <p class="article-more-link">
            <a href="/2016/03/30/stack-gen/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/30/stack-gen/" data-id="cimn9hgls0004vo4dverxaf4p" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-gitsshconfig" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/29/gitsshconfig/" class="article-date">
  <time datetime="2016-03-29T09:16:18.000Z" itemprop="datePublished">2016-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/29/gitsshconfig/">多个ras_id配置.ssh的config文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在使用ssh方式和git服务器通信的时候 会用到rsa生成公钥，重复生成时默认配置会覆盖掉之前生成的公钥和私钥，这时就需要添加config文件</p>
<pre><code>#进入.ssh目录
cd ~/.ssh
#创建config文件
vi config
<code></code></code></pre>

<p>添加以下内容</p>
<pre><code>
#主机别名 以后在访问的时候一定要用别名来访问
Host MyGitHost
#主机名
HostName github.com
#你的id
User last_afc@163.com
#端口号
Port 22
#公钥文件位置
IdentityFile ~/.ssh/id_rsa

###公司的git配置
Host MyDuomiGit
HostName 192.168.200.222
User git
Port 2222
IdentityFile ~/.ssh/ziyu.duomi.rsa
</code></pre>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/29/gitsshconfig/" data-id="cimn9hglq0003vo4dw0zlkqiw" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hexothemeconfig" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/29/hexothemeconfig/" class="article-date">
  <time datetime="2016-03-29T09:15:41.000Z" itemprop="datePublished">2016-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/29/hexothemeconfig/">hexothemeconfig</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/29/hexothemeconfig/" data-id="cimn9hglt0005vo4dwxm23uwh" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-cname-githubio" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/29/cname-githubio/" class="article-date">
  <time datetime="2016-03-29T07:02:59.000Z" itemprop="datePublished">2016-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/29/cname-githubio/">配置github.io域名指向</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###如何配置自己的gihub.io的域名指向。<br>进入用hexo生成的本地my_blog_name文件夹<br>
        
          <p class="article-more-link">
            <a href="/2016/03/29/cname-githubio/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/29/cname-githubio/" data-id="cimn9hglj0001vo4d4dozwfaf" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/28/hello-world/" class="article-date">
  <time datetime="2016-03-28T09:11:23.000Z" itemprop="datePublished">2016-03-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/28/hello-world/">基于github.io和hexo搭建技术博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="github配置"><a href="#github配置" class="headerlink" title="github配置"></a>github配置</h2><p>github提供了<a href="https://pages.github.com/" >pages</a>功能。能够生成属于你自己的站点。<br>登录自己的github，新建一个仓库，仓库的名字必须和你的github用户名一致<br>
        
          <p class="article-more-link">
            <a href="/2016/03/28/hello-world/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/28/hello-world/" data-id="cimn9hglm0002vo4daxits3fi" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/05/aboutbenchmark/">关于benchmark</a>
          </li>
        
          <li>
            <a href="/2016/03/31/stackjson/">OC数据结构（三.1）：用栈和状态机完成JSON解析</a>
          </li>
        
          <li>
            <a href="/2016/03/30/stack-usage/">OC数据结构（二）：栈的用途</a>
          </li>
        
          <li>
            <a href="/2016/03/30/stack-gen/">OC数据结构（二）：栈的生成</a>
          </li>
        
          <li>
            <a href="/2016/03/29/gitsshconfig/">多个ras_id配置.ssh的config文件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 看头像<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>